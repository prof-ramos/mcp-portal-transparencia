# ğŸš€ Guia de MigraÃ§Ã£o - TypeScript Deploy

## ğŸ“‹ AnÃ¡lise Atual vs. RecomendaÃ§Ã£o

### ConfiguraÃ§Ã£o Atual (SubÃ³tima)

```yaml
# smithery.yaml (ATUAL)
name: portal-transparencia-brasil
language: node
build:
  dockerfile: ./Dockerfile
  context: .
run:
  command: ['node', 'dist/src/mcp-server.js']
  env:
    NODE_ENV: 'production'
health:
  http:
    path: /health
    port: 3000
    interval: 10s
    timeout: 5s
    gracePeriod: 20s
```

### ConfiguraÃ§Ã£o Recomendada (Ã“tima)

```yaml
# smithery.yaml (RECOMENDADA)
runtime: 'typescript'
name: 'portal-transparencia-brasil'
description: 'MCP Server for Portal da TransparÃªncia API'

env:
  PORTAL_API_KEY:
    description: 'API key for Portal da TransparÃªncia'
    required: true
  LOG_LEVEL:
    description: 'Log level (error, warn, info, debug)'
    required: false
    default: 'info'

health:
  mcp:
    timeoutMs: 15000
```

## ğŸ”„ Processo de MigraÃ§Ã£o

### Fase 1: PreparaÃ§Ã£o

1. **Verificar compatibilidade TypeScript**

   ```bash
   # Verificar se o build funciona
   npm run build
   
   # Testar o servidor localmente
   node dist/src/mcp-server.js
   ```

2. **Validar package.json**

   ```json
   {
     "type": "commonjs",
     "main": "dist/src/mcp-server.js",
     "scripts": {
       "build": "tsc",
       "start": "node dist/src/mcp-server.js"
     }
   }
   ```

### Fase 2: ImplementaÃ§Ã£o

1. **Atualizar smithery.yaml**

   ```yaml
   runtime: 'typescript'
   name: 'portal-transparencia-brasil'
   description: 'MCP Server for Portal da TransparÃªncia API'
   
   env:
     PORTAL_API_KEY:
       description: 'API key for Portal da TransparÃªncia'
       required: true
     LOG_LEVEL:
       description: 'Log level (error, warn, info, debug)'
       required: false
       default: 'info'
   
   health:
     mcp:
       timeoutMs: 15000
   ```

2. **Implementar Lazy Loading**

   ```typescript
   // src/mcp-server.ts
   server.setRequestHandler('tools/list', async () => {
     // Sem validaÃ§Ã£o de API key - permite descoberta
     return {
       tools: [
         {
           name: 'consultar_servidores',
           description: 'Consultar servidores do Poder Executivo Federal',
           inputSchema: {
             type: 'object',
             properties: {
               // schema da ferramenta
             },
           },
         },
       ],
     };
   });
   ```

3. **Remover arquivos desnecessÃ¡rios**

   ```bash
   # Opcional: remover Dockerfile se nÃ£o for mais necessÃ¡rio
   # rm Dockerfile
   
   # Opcional: remover smithery.json se duplicado
   # rm smithery.json
   ```

### Fase 3: ValidaÃ§Ã£o

1. **Teste local**

   ```bash
   npm run build
   node dist/src/mcp-server.js
   ```

2. **Deploy no Smithery**

   ```bash
   git add .
   git commit -m "feat: migrate to TypeScript Deploy"
   git push origin main
   ```

## ğŸ“ˆ BenefÃ­cios da MigraÃ§Ã£o

### Performance

- âš¡ **Build mais rÃ¡pido**: AutomÃ¡tico vs. Docker
- âš¡ **Deploy mais rÃ¡pido**: TypeScript runtime otimizado
- âš¡ **Menos recursos**: Sem container Docker

### Manutenibilidade

- ğŸ”§ **ConfiguraÃ§Ã£o simplificada**: Apenas `smithery.yaml`
- ğŸ”§ **Menos arquivos**: Sem Dockerfile necessÃ¡rio
- ğŸ”§ **IntegraÃ§Ã£o nativa**: Melhor suporte Smithery

### ExperiÃªncia do UsuÃ¡rio

- ğŸ¯ **Descoberta de ferramentas**: Lazy loading implementado
- ğŸ¯ **ConfiguraÃ§Ã£o mais clara**: Schema de configuraÃ§Ã£o
- ğŸ¯ **Health check melhorado**: MCP nativo

## ğŸš¨ ConsideraÃ§Ãµes Importantes

### Breaking Changes

- âš ï¸ **Dockerfile**: Pode ser removido
- âš ï¸ **smithery.json**: Pode ser removido
- âš ï¸ **Health endpoint**: MudanÃ§a de HTTP para MCP

### Rollback Plan

```bash
# Se necessÃ¡rio, reverter para configuraÃ§Ã£o anterior
git checkout HEAD~1 smithery.yaml
git commit -m "revert: back to custom deploy"
```

## ğŸ“‹ Checklist de MigraÃ§Ã£o

### PrÃ©-requisitos

- [ ] TypeScript MCP server funcional
- [ ] `package.json` com entry points corretos
- [ ] Build local funcionando

### MigraÃ§Ã£o

- [ ] Atualizar `smithery.yaml` para `runtime: "typescript"`
- [ ] Implementar lazy loading em `mcp-server.ts`
- [ ] Remover `smithery.json` (opcional)
- [ ] Testar build e deploy local

### ValidaÃ§Ã£o

- [ ] Deploy no Smithery
- [ ] Verificar health check
- [ ] Testar descoberta de ferramentas
- [ ] Validar configuraÃ§Ã£o de ambiente

## ğŸ¯ PrÃ³ximos Passos

1. **Implementar lazy loading** no cÃ³digo atual
2. **Migrar para `runtime: "typescript"`**
3. **Simplificar configuraÃ§Ã£o** removendo duplicaÃ§Ãµes
4. **Testar e validar** no ambiente Smithery

## ğŸ“š ReferÃªncias

- [Smithery Deployments Documentation](https://smithery.ai/docs/build/deployments)
- [TypeScript Runtime Guide](https://smithery.ai/docs/build/getting-started)
- [MCP Health Check](https://modelcontextprotocol.io/specification/2025-03-26/basic/transports#streamable-http)
description:
globs:
alwaysApply: false

---
